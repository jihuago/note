## 数据页结构
数据页代表的16KB大小的存储空间可以被划分为多个部分，不同部分有不同的功能。
![](../images/20210803171238.png)
![](../images/20210803171317.png)
## 记录在页中的存储

## 页目录(Page Diretory)
> Page Header是专门针对数据页记录的各种状态信息，比方说页里头有多少记录，有多少个槽。
记录在页中按照主键值由小到大顺序串联成一个单链表，那如果想根据主键值查找页中某条记录怎么办？
> select * from page_demo where c1 = 3;

InnoDB的目录的制作过程：
1. 将所有正常的记录（包括最大和最小记录，不包含标记为已删除的记录）划分为几个组
2. 每个组的最后一条记录的头信息中的n_owned属性表示该记录拥有多少条记录，也就是该组内共有几条记录
3. 将每个组的最后一条记录的地址偏移量单独提取出来按顺序存储到靠近页的尾部的地方，这个地方就是所谓的
Page Diretory，也就是页目录。
   页面中的这些地址偏移量被称为槽（slot），所以这个页面目录就是由槽组成的
   
所以在一个数据页中查找指定主键值的记录的过程分为两步：
1. 通过二分法确定该记录所在的槽，并找到该槽所在分组中主键值最小的那条记录
2. 通过记录的next_record属性遍历该槽所在的组中的各个记录

## File Header(文件头部)，固定38字节
File Header针对各种类型的页都通用，也就是说不同类型的页都会以File Header作为第一组部分，File Header
描述了一些针对各种页都通用的一些信息，比如这个页的编号是多少，它的上一个页、下一个页。
* FIL_PAGE_PREV和FIL_PAGE_NEXT
  FIL_PAGE_PREV和FIL_PAGE_NEXT分别代表本页的上一个和下一个页的页号。

## 总结
* InnoDB为了不同的目的而设计了不同类型的页，我们把用于存放记录的页叫做数据页
* 一个数据页可以被大致划分为7个部分，分别是
    * File Header，表示页的一些通用信息，占固定的38字节
    * Page Header，表示数据页专用的一些信息，占固定的56个字节
    * User Records 真实存储我们插入的记录的部分，大小不固定
    * Page Directory 页中的某些记录相对位置，也就是各个槽在页面中的地址偏移量，大小不固定，插入的记录越多，这个部分占用的空间越多
    * File Trailer 用于检验页是否完整的部分
    
* 每个记录的头信息中都有一个next_record属性，从而使页中的所有记录串联成一个单链表
* InnoDB会把页中的记录划分若干个组，每个组的最后一个记录的地址偏移量作为一个槽，存放在Page Directory中，所以在一个页中根据主键查找记录非常快的：
    * 通过二分法确定该记录所在的槽
    * 通过记录的next_record属性遍历该槽所在的组中的各个记录
    
* 每个数据页的File Header部分都有上一个和下一个页的编号，所以所有的数据页会组成一个双链表

    